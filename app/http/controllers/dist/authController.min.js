"use strict";var _require=require("express"),request=_require.request,passport=require("passport"),User=require("../../models/user"),bcrypt=require("bcrypt");function authController(){return{login:function(e,r){r.render("auth/login")},postLogin:function(n,s,a){var e=n.body,r=e.email,t=e.password;if(!r||!t)return n.flash("error","All fields are required"),s.redirect("/login");passport.authenticate("local",function(e,r,t){return e?(n.flash("error",t.message),a(e)):r?void n.logIn(r,function(e){return e?(n.flash("error",t.message),a(e)):s.redirect("/")}):(n.flash("error",t.message),s.redirect("/login"))})(n,s,a)},register:function(e,r){r.render("auth/register")},postRegister:function(t,n){var r,s,a,i,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.body,s=r.name,a=r.email,i=r.password,s&&a&&i){e.next=6;break}return t.flash("error","All fields are required"),t.flash("name",s),t.flash("email",a),e.abrupt("return",n.redirect("/register"));case 6:return User.exists({email:a},function(e,r){if(r)return t.flash("error","Email already taken"),t.flash("name",s),t.flash("email",a),n.redirect("/register")}),e.next=9,regeneratorRuntime.awrap(bcrypt.hash(i,10));case 9:o=e.sent,new User({name:s,email:a,password:o}).save().then(function(e){return n.redirect("/")}).catch(function(e){return t.flash("error","Something went wrong"),n.redirect("/register")});case 12:case"end":return e.stop()}})},logout:function(e,r){return e.logout(),r.redirect("/login")}}}module.exports=authController;
//# sourceMappingURL=authController.min.js.map
