"use strict";var Order=require("../../../models/order"),moment=require("moment");function orderController(){return{store:function(t,n){var e=t.body,r=e.phone,s=e.address;if(!r||!s)return t.flash("error","Please fill all the fields."),n.redirect("/cart");new Order({customerId:t.user._id,items:t.session.cart.items,phone:r,address:s}).save().then(function(e){Order.populate(e,{path:"customerId"},function(e,r){return t.flash("success","Order placed Successfully"),delete t.session.cart,t.app.get("eventEmitter").emit("orderPlaced",r),n.redirect("/customer/orders")})}).catch(function(e){return t.flash("error","Something went wrong"),n.redirect("/cart")})},index:function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Order.find({customerId:r.user._id},null,{sort:{createdAt:-1}}));case 2:n=e.sent,t.header("Cache-Control","no-store"),t.render("customers/orders",{orders:n,moment:moment});case 5:case"end":return e.stop()}})},show:function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Order.findById(r.params.id));case 2:if(n=e.sent,r.user._id.toString()===n.customerId.toString())return e.abrupt("return",t.render("customers/singleOrder",{order:n}));e.next=7;break;case 7:return e.abrupt("return",t.redirect("/"));case 8:case"end":return e.stop()}})}}}module.exports=orderController;
//# sourceMappingURL=orderController.min.js.map
